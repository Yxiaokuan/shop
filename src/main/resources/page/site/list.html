<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- saved from url=(0044)http://localhost:8080/getInfomation?PRO_ID=4 -->
<html lang="zh" class="windows desktop landscape">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1">
    <meta http-equiv="X-UA-Compatible" content="IE=9">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=1190">
    <title>项目列表</title>
    <!-- style for large viewport -->
    <link href="../../static/css/bootstrap.min.css" rel="stylesheet">
    <link href="../../static/css/bootstrap-table.css" rel="stylesheet">
    <link href="../../static/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../../static/css/css1.css">
    <!-- style for large viewport -->
    <link href="../../static/css/common.css" rel="stylesheet">
    <link href="../../static/css/enchiridion.css" rel="stylesheet">
    <link rel="stylesheet" href="../../static/layui/css/layui.css" type="text/css"/>
    <script type="text/javascript" src="../../static/js/jquery-1.8.2.js"></script>
    <script type="text/javascript" src="../../static/layui/layui.js">
    </script>
    <script type="text/javascript" src="../../static/js/myJs.js"></script>
    <script type="text/javascript" src="../../static/js/xm-select.js"></script>

    <style type="text/css">
        .td_title {
            background-color: #F5F5F5;
        }

        .input {border-radius:2px;width:100%;height:26px;font-size: 16px;background-color:#FFFAFA;border:1px solid #DBDBDB ;}

        textarea {border-radius:2px;width:100%;height:50px;font-size: 16px;background-color:#FFFAFA;border:1px solid #DBDBDB ;}

        <!--
        .hr0 {
            height: 2px;
            border-top-width: 2px;
            border-top-style: solid;
            border-right-style: none;
            border-bottom-style: none;
            border-left-style: none;
            border-top-color: #C00;
            margin-top: -20px;
        }
        .layui-table-cell{
            height:36px;
            line-height: 36px;
        }

        -->
    </style>
</head>

<body data-spy="scroll" data-target=".navbar-affix">
<div id="container">
    <div class="common-content layui-bg-gray">
        <form class="layui-form" id="queryDataForm">
            <div class="layui-form-item" style="padding-top: 10px">
                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">站点名</label>
                    <div class="layui-input-inline">
                        <input type="text" name="sname"  autocomplete="off" class="layui-input">
                    </div>
                </div>


                <div class="layui-inline">
                    <button type="button" id="searchbtn" data-type="reload" class="searchbtn layui-btn layui-btn-radius">查询</button>
                    <input type="reset" value="重置" class="layui-btn layui-btn-primary" id="resetbtn"/>
                </div>
            </div>

        </form>
    </div>


    <script type="text/html" id="bardataTable">
        <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
    </script>
    <div class="common-content" style="padding-top:0px">
        <!-- “项目信息库”模块 start -->
        <table class="layui-hide" id="dataTable" lay-filter="dataTable"></table>
        <!-- “办理信息事项”模块 start -->
    </div>


</div>
<script type="text/html" id="switch">
    {{#  if(d.status == 0){ }}
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="forbidden">禁用</a>
    {{#  } }}
    {{#  if(d.status == 2){ }}
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="open">启用</a>
    {{#  } }}

</script>
<script>
    layui.use('table',
        function() {
            var table = layui.table;
            table.render({
                elem: '#dataTable'
                ,height: 650
                ,url: '/site/search' //数据接口
                ,title: '用户表'
                ,page: true //开启分页
                ,toolbar: 'default' //开启工具栏，此处显示默认图标，可以自定义模板，详见文档
                // ,totalRow: true //开启合计行
                // ,toolbar                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                : ["filter", "exports", "print"]
                ,cols: [[ //表头
                    {type: 'checkbox', fixed: 'left',align:'center'}
                    ,{field: 'siteid', title: '站点id', width:200, sort: true, fixed: 'left', totalRowText: '合计：'}
                    ,{field: 'sid', title: '地铁线', width:200}
                    ,{field: 'sname', title: '站点名', width:200}
                    ,{field: 'regions', title: '所属区域', width:250,
                        templet: function (d) {
                        var val="";
                            for (var i = 0; i <d.regions.length ; i++) {
                                if (d.regions[i].rname!= null) {
                                    if(i==d.regions.length-1){
                                        val = val+d.regions[i].rname;
                                    }else{
                                        val = val+d.regions[i].rname+",";
                                    }

                                }
                            }
                            return  val;

                        }}
                    ,{fixed: 'right',title: '操作', width: 165, align:'center', toolbar: '#bardataTable'}
                ]],
                parseData: function (res) {
                    return {
                        "code": "0", //解析接口
                        "msg": res.msg, //解
                        "count":res.data.total,
                        "data": res.data.rows
                    };
                }
            });
        });
    var layer;
    layui.use(['form', 'laydate', 'laypage', 'layer', 'table', 'upload', 'element'], function(){
        var form = layui.form;
        form.render(); // 加入这一句
        var $ = layui.jquery;
        var laydate = layui.laydate //日期
            ,laypage = layui.laypage //分页
            ,layer = layui.layer //弹层
            ,table = layui.table //表格
            ,upload = layui.upload //上传
            ,element = layui.element ;//元素操作


        laydate.render({
            elem: '#beginDate',
            format: 'yyyy-MM-dd',
            trigger: 'click',
            done: function (value) {
                var startDate = new Date(value).getTime();
                var endTime = new Date($('#endDate').val()).getTime();
                if (endTime < startDate) {
                    layer.msg('开始时间不能大于结束时间');
                    $('#beginDate').val('');
                }
            }
        });
        laydate.render({ //结束时间
            elem: '#endDate',
            format: 'yyyy-MM-dd',
            trigger: 'click',
            done: function (value) {
                var startDate = new Date($('#beginDate').val()).getTime();
                var endTime = new Date(value).getTime();
                if (endTime < startDate) {
                    layer.msg('结束时间不能小于开始时间');
                    $('#endDate').val('');
                }
            }

        });






        //监听头工具栏事件
        table.on('toolbar(dataTable)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id)
                ,data = checkStatus.data; //获取选中的数据
            switch(obj.event){
                case 'add':
                    window.location.href = "/public/site/add";
                    break;
                case 'update':
                    if(data.length === 0){
                        layer.msg('请选择一行');
                    } else if(data.length > 1){
                        layer.msg('只能同时编辑一个');
                    } else {
                        data = data[0];
                        var w = ($(window).width() * 0.7);
                        var h = ($(window).height() - 50);
                        layer.open({
                            resize: false,
                            title: '修改',
                            shadeClose: true,
                            area: [w + 'px', h + 'px'],
                            type: 2,
                            content: '/public/site/edit/'+data.siteid

                        });
                    }
                    break;
                case 'delete':
                    if(data.length === 0){
                        layer.msg('请至少选择一行');
                    } else if(data.length === 1){
                        layer.confirm('确定删除吗?', function(index){
                            layer.close(index);
                            //向服务端发送删除指令
                            $.ajax({
                                async: false,
                                type: "delete",
                                url: "/site/"+data.siteid,
                                // data: {uid} ,
                                dataType: "JSON",
                                // mimeType: "multipart/form-data",
                                // contentType:  "application/json;charset=UTF-8",
                                cache: false,
                                processData: false,
                                success: function (data) {
                                    layer.msg(data.msg);
                                }
                            })
                        });


                    }
                    break;
            }
        });

        //监听行工具事件
        table.on('tool(dataTable)', function(obj){ //注：tool 是工具条事件名，test 是 table 原始容器的属性 lay-filter="对应的值"
            var data = obj.data //获得当前行数据
                ,layEvent = obj.event; //获得 lay-event 对应的值
            if(layEvent === 'detail'){
                layer.msg('查看操作');
            } else if(layEvent === 'del'){
                layer.confirm('真的删除行么', function(index){
                    obj.del(); //删除对应行（tr）的DOM结构
                    layer.close(index);
                    //向服务端发送删除指令
                    $.ajax({
                        async: false,
                        type: "delete",
                        url: "/site/"+data.siteid,
                        // data: {uid} ,
                        dataType: "JSON",
                        // mimeType: "multipart/form-data",
                        // contentType:  "application/json;charset=UTF-8",
                        cache: false,
                        processData: false,
                        success: function (data) {
                            layer.msg(data.msg);
                        }
                    })
                });
            } else if(layEvent === 'edit'){
                var w = ($(window).width() * 0.7);
                var h = ($(window).height() - 50);
                layer.open({
                    resize: false,
                    title: '修改',
                    shadeClose: true,
                    area: [w + 'px', h + 'px'],
                    type: 2,
                    content: '/public/site/edit/'+data.siteid
                });
            }
        });
        //分页
        $("#searchbtn").bind(
            "click",
            function () {
                var where = $("#queryDataForm").serializeObject();
                reloadDataTable(where);
            });

        function reloadDataTable(where) {
            table.reload("dataTable", {
                where: where,
                page: {
                    //查询时从第一页开始
                    curr: 1
                }
            });
        }


    });




    function openWin(url){
        window.open(url);
    }
</script>

</body>
</html>